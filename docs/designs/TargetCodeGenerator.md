# TargetCodeGenerator 概要

`TargetCodeGenerator` は、ソースファイルからターゲットファイルを生成するためのクラスです。このクラスは、指定された要件に基づいてコードを生成し、必要に応じてそのコードを実行する機能を持ちます。

## 主な機能

- **初期化**:
  - コンストラクタでは、以下の入力パラメータを受け取ります：
    - `source_file_path`: 入力するソースファイルのパス。
    - `target_file_path`: 出力するターゲットファイルのパス。
    - `past_source_file_path`: 過去のソースファイルのパス（変更履歴のため）。
    - `source_hash`: ソースファイルのハッシュ値（変更検知用）。

- **コード生成処理**:
  - `generate_target_code()` メソッドを呼び出すことで、ソースファイルを読み込み、ターゲットファイルを生成します。このメソッドは、以下のステップを通じて処理を行います：
    1. **準備**: コード生成に必要な情報を設定します。
    2. **ソースファイルの読み込み**: ソースファイルの内容を読み込み、変数を作成します。
    3. **プロンプトの読み込みとコード生成**: 要件定義書からプロンプトを読み込み、指定されたモデルを使用してコードを生成します。
    4. **生成されたコードの処理**: コードを書き込むとともに、必要に応じてソースファイルのハッシュを追記します。
    5. **結果の出力**: ターゲットファイルのパスなどを出力します。

- **ファイル操作**:
  - `save_current_source_as_past()`: 現在のソースファイルを過去のソースファイルとして保存します。
  - `read_source_file()`: ソースファイルの内容を読み込みます。
  - `write_code_to_target_file()`: 生成されたコードをターゲットファイルに書き込みます。

- **エラー処理**:
  - `try_execute_generated_code()`: 生成されたコードを実行し、エラーが発生した場合には修正を試みます。

## 入力の種類

このクラスでは、以下の入力が必要です：

1. **ソースファイル**:
   - コード生成の基となるファイルで、通常はMarkdown形式や他の形式の要件定義書です。例:
     ```bash
     source_file_path = "requirements.md"
     ```

2. **ターゲットファイル**:
   - 生成されるコードが書き込まれるファイルで、通常はPythonファイルです。例:
     ```bash
     target_file_path = "generated_code.py"
     ```

3. **過去のソースファイル**:
   - 変更履歴を保持するためのファイルパスで、過去のソースファイルを保存する際に使用されます。

4. **ソースファイルのハッシュ値**:
   - ソースファイルの変更検知のために使用されるハッシュ値です。

## 出力

コード生成処理の結果、以下の出力が得られます：

- **ターゲットファイル**: 指定されたパスに生成されたPythonファイルが出力され、その中には生成されたコードが含まれます。
- **出力メッセージ**: ターゲットファイルのパスや処理の進行状況がコンソールに表示されます。

## 機能フロー

```mermaid
flowchart TD
    A[ソースファイルの入力] --> B[ターゲットファイルのパス指定]
    B --> C[過去のソースファイルパス指定]
    C --> D[ソースファイルの読み込み]
    D --> E[変数の作成]
    E --> F[プロンプトの読み込み]
    F --> G[コード生成]
    G --> H[生成されたコードの処理]
    H --> I[結果の出力]
